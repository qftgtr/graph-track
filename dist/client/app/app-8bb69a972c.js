"use strict";var GraphTrackForceLayout=function(t,e,n){function r(t){var e=[];return t.forEach(function(t,n){"launch"!==t.state&&(h[t.state]=e.length,b[t.state]=t.launch,x[t.state]={ins:[],outs:[]},e.push({state:t.state,count:t.count,launch:t.launch,exit:t.exit,group:1}))}),e}function o(t){return t.map(function(t){return b[t.state_from]-=t.count,b[t.state_to]+=t.count,x[t.state_to].ins.push(t),x[t.state_from].outs.push(t),{source:h[t.state_from],target:h[t.state_to],count:t.count}})}function a(t){return 1.5*Math.sqrt(t)}function c(t){return y.selectAll(".gt-force-link").data(t).enter().append("line").attr("class","gt-force-link").style("stroke-width",function(t){return a(t.count)}).on("mouseover",p).on("mouseout",l)}function u(t){var e=y.selectAll(".gt-force-node").data(t).enter().append("g").attr("class","gt-force-node").call(g.drag);return e.append("line").attr("class","gt-force-link gt-force-link-launch").style("stroke-width",function(t){return a(t.launch)}).attr("x1",0).attr("y1",-n).attr("x2",0).attr("y2",0),e.append("line").attr("class","gt-force-link gt-force-link-exit").style("stroke-width",function(t){return a(b[t.state])}).attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",n),e.append("circle").attr("r",function(t){return Math.sqrt(t.count)}).style("fill",function(t){return d(t.group)}).on("mouseover",i).on("mouseout",l),e.append("text").attr("dy",".3em").text(function(t){return t.state}).on("mouseover",i).on("mouseout",l),e}function s(t){var e='<pre class="gt-force-tooltip-box"><p><kbd>'+t.state+"</kbd> "+t.count+"</p></pre>";return e+='<pre class="gt-force-tooltip-box gt-force-tooltip-box-in">',e+="<p><b>流入</b></p>",t.launch&&(e+='<p><kbd style="background:aquamarine;">启动</kbd> '+t.launch+"</p>"),e+="<p>"+x[t.state].ins.map(function(t){return"<kbd>"+t.state_from+"</kbd> "+t.count+"</p>"}).join(""),e+="</p></pre>",e+='<pre class="gt-force-tooltip-box gt-force-tooltip-box-out">',e+="<p><b>流出</b></p>",b[t.state]&&(e+='<p><kbd style="background:coral;color:white;">退出</kbd> '+b[t.state]+"</p>"),e+="<p>"+x[t.state].outs.map(function(t){return"<kbd>"+t.state_to+"</kbd> "+t.count+"</p>"}).join(""),e+="</p></pre>"}function i(t){k.transition().duration(200).style("opacity",.9),k.html(s(t)).style("left",d3.event.pageX+"px").style("top",d3.event.pageY+20+"px")}function p(t){k.transition().duration(200).style("opacity",.9),k.html('<pre class="gt-force-tooltip-box"><kbd>'+t.source.state+"</kbd> -> <kbd>"+t.target.state+"</kbd> "+t.count+"</pre>").style("left",d3.event.pageX+"px").style("top",d3.event.pageY+20+"px")}function l(t){k.transition().duration(200).style("opacity",0)}function f(t){d3.json(t,function(t,e){if(t)throw t;var n=r(e[0]),a=o(e[1]);g.nodes(n).links(a).start();var s=c(a),i=u(n);g.on("tick",function(){s.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y}),i.attr("transform",function(t){return"translate("+t.x+","+t.y+")"})})})}var d=d3.scale.category20(),g=d3.layout.force().charge(-1e3).linkDistance(100).size([e,n]),y=d3.select(t).append("svg").attr("width",e).attr("height",n),k=d3.select(t).append("div").attr("class","gt-force-tooltip").style("opacity",0),h={},b={},x={};return{render:f}},gt=GraphTrackForceLayout("body",1200,640);gt.render("/api/track/graph?appVersion=0.1"),function(t,e){t.module("graphTrackApp.constants",[]).constant("appConfig",{userRoles:["guest","user","admin"]})}(angular);